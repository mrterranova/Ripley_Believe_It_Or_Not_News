<style>
    @font-face {
        font-family: strange;
        src: url(images/strange.ttf);
    }

    body {
        background: url("images/bubbles.jpg");
        background: cover;
    }

    h1 {
        font-family: strange;
        color: goldenrod;
        text-shadow:
            -2px -2px 0 #000,
            2px -2px 0 #000,
            -2px 2px 0 #000,
            2px 2px 0 #000;
        font-size: 68px;
    }

    h2 {
        font-family: strange;
        color: goldenrod;
        text-shadow:
            -2px -2px 0 #000,
            2px -2px 0 #000,
            -2px 2px 0 #000,
            2px 2px 0 #000;

    }

    #colors {
        z-index: -1;
        position: absolute;
        margin-left: -170px;
        width: 100vw;
    }

    .storyBox {
        margin-top: 50px;
        width: 50%;
        height: 610px;
        overflow: auto;
        float: left;
        text-align: center;
        background-color: rgba(255, 244, 236, 0.5);
    }

    .articleTitle:hover {
        cursor: pointer;
    }

    .articleSummary {
        margin-left: 50px;
    }

    .notes {
        margin-top: 20px;
        width: 50%;
        float: right;
        padding: 10px 70px 70px 70px;
    }

    #theNotes {
        width: 100%;
    }

    .thisArticleTitle {
        text-align: center;
        color: goldenrod;
        text-shadow:
            -2px -2px 0 #000,
            2px -2px 0 #000,
            -2px 2px 0 #000,
            2px 2px 0 #000;
    }

    .seePrevious {
        background-color: rgba(255, 244, 236, 0.5);
        width: 100%;
        height: 230px;
        overflow: auto;
    }

    #noteTitle {
        padding-left: 10px;
    }

    #noteBody {
        width: 100%;
        padding: 3px;
    }

    .seePrevious {
        padding: 5px 20px 0px 20px;
    }
</style>
<div class="container">
    <h1 style="text-align: center;">RIPLELY'S...BELIVE IT OR NOT NEWS!</h1>
    <div class="storyBox">
        {{#each article}}
        <br>
        <h3 class="articleTitle" data-id='{{this.id}}' data-title='{{this.title}}'>{{this.title}}</h3>
        <p class="articleSummary">{{this.summary}}</p>
        <a href="{{this.url}}" target="_blank"><button class="btn btn-warning" style="margin-bottom: 10px;">Visit Article</button></a>
        {{/each}}
    </div>
    <div class="notes">
    </div>
</div>

<script>
    $(document).on("click", ".articleTitle", function () {
        //assign and id to the article clicked to collect correct data
        var thisId = $(this).attr("data-id");

        //ajax call to get the article by id
        $.ajax({
            method: "GET",
            url: "/articles/" + thisId
        }).then(function (data) {
            var previousTitle;
            var previousNote;
            //will not appear if undefined so give data.note a placeholder value
            if (data.note == undefined) {
                previousTitle = "";
                previousNote = "There are no previous comments";
            } 
            //if previous note, then collect from the correct location
            else {
                previousTitle = data.note.title;
                previousNote = data.note.body;
            }
            //build variable for the information below in order to get a note per entry
            appendingInfo = '<h3 class="thisArticleTitle">' + data.title + '</h3><form><input id="noteTitle" type="text" style="width:100%; margin-bottom:10px;" placeholder="Title of Comment Here..."' +
                '><textarea id="noteBody" cols="30" rows="10" placeholder="Type your comment here..." maxlength="200"></textarea>' +
                '<input id="btnSubmit" type="submit" data-id="' + data._id + '" class="btn btn-warning" style="width:100%;"></form><div class="seePrevious">Previous comment made about... <span id="commentMadeTitle"><strong>' + data.title + '</strong></span><br><br><span id="prevTitle">Previous Title: <br><i><strong>'+previousTitle+'</strong></i></span><br><br><span id="prevNote">Previous Comment:  <br><i>'+previousNote+'</i></span></div>'
            //append variable here
            $(".notes").html(appendingInfo)
        });
    });

    //when click on the btnSubmit then send the note
    $(document).on("click", "#btnSubmit", function () {
        // take the id associated with the btn
        var thisId = $(this).attr("data-id");
        // POST request for the notes
        $.ajax({
            method: "POST",
            url: "/articles/" + thisId,
            data: {
                // Value taken from title input
                title: $("#noteTitle").val(),
                // Value taken from note textarea
                body: $("#noteBody").val()
            }
        }).then(function (data) {
                // show the data sent
                console.log(data);
            });

        // Remove all previous entries
        $("#noteTitle").val("");
        $("#noteBody").val("");
    });
</script>